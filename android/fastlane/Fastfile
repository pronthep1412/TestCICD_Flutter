
# android/fastlane/Fastfile - Android Fastlane Configuration
default_platform(:android)

platform :android do
  desc "Deploy to Google Play Store"
  lane :deploy do |options|
    track = options[:track] || "internal"
    aab_path = options[:aab] || "../build/app/outputs/bundle/release/app-release.aab"
    json_key_path = options[:json_key] || "google-play-key.json"
    
    # Validate inputs
    UI.message("ðŸš€ Deploying to Google Play - Track: #{track}")
    UI.message("ðŸ“¦ AAB Path: #{aab_path}")
    
    # Verify AAB exists
    unless File.exist?(aab_path)
      UI.user_error!("AAB file not found at: #{aab_path}")
    end
    
    # Upload to Google Play
    upload_to_play_store(
      track: track,
      aab: aab_path,
      json_key: json_key_path,
      skip_upload_metadata: true,
      skip_upload_images: true,
      skip_upload_screenshots: true,
      release_status: track == "production" ? "completed" : "draft"
    )
    
    UI.success("âœ… Successfully deployed to #{track} track!")
  end
  
  desc "Deploy to specific branch track"
  lane :deploy_main do
    deploy(track: "production")
  end
  
  lane :deploy_staging do
    deploy(track: "beta")
  end
  
  lane :deploy_develop do
    deploy(track: "internal")
  end
end